<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCFS Toll Booth Simulator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for aesthetic enhancements and font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        .gantt-block {
            min-width: 50px; 
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            border-radius: 8px;
            margin-right: 4px;
            position: relative;
            background-color: #059669; /* Emerald 600 */
        }
        .gantt-block.idle {
            background-color: #9ca3af; /* Gray 400 */
        }
        .gantt-time-marker {
            position: absolute;
            bottom: -25px;
            right: -10px;
            font-size: 0.75rem;
            color: #4b5563; /* Gray 600 */
        }
        /* Ensure the gantt chart has room for markers */
        #ganttChart {
            margin-bottom: 30px; 
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app" class="max-w-6xl mx-auto">

        <!-- Header Section -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-2">FCFS in Action: Single-Lane Toll Booth Simulator</h1>
            <p class="text-xl text-indigo-600">Modeling Traffic Flow with First-Come, First-Served Scheduling</p>
        </header>

        <!-- Content Section: Explanation -->
        <div class="grid lg:grid-cols-3 gap-8 mb-12">
            
            <!-- Toll Booth Analogy -->
            <div class="card bg-white p-6 rounded-xl border border-gray-200 lg:col-span-2">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.828 0l-4.243-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    The FCFS Analogy: Cars in a Queue
                </h2>
                <p class="text-gray-700 leading-relaxed">
                    A single-lane toll booth operates on a strict FCFS principle. Each car (process) is served in the order it arrives (Arrival Time). Once a car begins its transaction (Service Time), it cannot be interrupted until the transaction is complete (non-preemptive). This real-world model clearly demonstrates FCFS behavior, especially the potential for **convoy effect**â€”where a small car must wait behind a long transaction (a process with a large burst time).
                </p>
                <p class="text-gray-700 leading-relaxed mt-3">
                    In this simulation: **Arrival Time (AT)** is when the car joins the queue, and **Service Time (ST)** is how long the transaction takes (paying cash, arguing about a ticket, etc.).
                </p>
            </div>

            <!-- FCFS Impact -->
            <div class="card bg-white p-6 rounded-xl border border-gray-200">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    Convoy Effect
                </h2>
                <ul class="text-gray-700 space-y-2">
                    <li>This occurs when a process with a very long burst time blocks the CPU.</li>
                    <li>In the toll booth, this is a large truck with a complicated transaction (long Service Time) holding up many small cars behind it.</li>
                    <li>This drastically increases the **Average Waiting Time** for short processes/transactions.</li>
                </ul>
            </div>
        </div>

        <!-- Toll Booth Simulator Section -->
        <div class="card bg-white p-8 rounded-xl border border-gray-200">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-3 flex items-center">
                <svg class="w-8 h-8 mr-3 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                Toll Booth Queue Manager
            </h2>

            <!-- Input Form -->
            <div class="grid md:grid-cols-5 gap-4 items-end mb-6 bg-gray-50 p-4 rounded-lg border">
                <div class="md:col-span-1">
                    <label for="carId" class="block text-sm font-medium text-gray-700">Car ID (e.g., C1)</label>
                    <input type="text" id="carId" value="" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="C5">
                </div>
                <div class="md:col-span-1">
                    <label for="arrival" class="block text-sm font-medium text-gray-700">Arrival Time (sec)</label>
                    <input type="number" id="arrival" value="0" min="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                <div class="md:col-span-1">
                    <label for="service" class="block text-sm font-medium text-gray-700">Service Time (sec)</label>
                    <input type="number" id="service" value="5" min="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                <div class="md:col-span-2 flex space-x-2">
                    <button id="addCarBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 shadow-md">
                        Add Car to Queue
                    </button>
                    <button id="runSimulationBtn" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 shadow-md">
                        Simulate FCFS
                    </button>
                </div>
            </div>

            <!-- Car List -->
            <h3 class="text-xl font-semibold text-gray-800 mb-3 mt-8">Toll Booth Queue</h3>
            <div class="overflow-x-auto mb-8">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Car ID</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Arrival Time (AT)</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Service Time (ST)</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                        </tr>
                    </thead>
                    <!-- NOTE: Event listener for deletion is added to this tbody -->
                    <tbody id="carListBody" class="bg-white divide-y divide-gray-200">
                        <!-- Initial cars will be listed here -->
                    </tbody>
                </table>
            </div>

            <!-- Simulation Results -->
            <div id="resultsArea" class="hidden">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 mt-8">Toll Booth Activity Chart (Gantt)</h3>
                <div id="ganttChart" class="flex flex-wrap items-end mb-8 border-b-2 border-gray-400 pb-1 relative min-h-[100px]">
                    <!-- Gantt chart blocks will be inserted here -->
                </div>

                <h3 class="text-xl font-semibold text-gray-800 mb-4 mt-8">Performance Metrics (Time in Seconds)</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200 border rounded-lg">
                        <thead class="bg-indigo-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Car ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">AT</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ST</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Finish Time (FT)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Time in System (TAT)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Waiting Time (WT)</th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody" class="bg-white divide-y divide-gray-200">
                            <!-- Results will be inserted here -->
                        </tbody>
                        <tfoot class="bg-gray-100 border-t border-gray-300">
                            <tr>
                                <td colspan="4" class="px-6 py-3 text-right font-bold text-gray-700">Average Times:</td>
                                <td id="avgTAT" class="px-6 py-3 font-bold text-gray-800"></td>
                                <td id="avgWT" class="px-6 py-3 font-bold text-gray-800"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <!-- Alert Box for messages -->
            <div id="messageBox" class="mt-6 p-4 text-sm rounded-lg text-red-700 bg-red-100 hidden" role="alert"></div>

        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const carListBody = document.getElementById('carListBody');
            const ganttChart = document.getElementById('ganttChart');
            const resultsBody = document.getElementById('resultsBody');
            const resultsArea = document.getElementById('resultsArea');
            const messageBox = document.getElementById('messageBox');
            const avgTATElement = document.getElementById('avgTAT');
            const avgWTElement = document.getElementById('avgWT');
            const idInput = document.getElementById('carId');
            
            let cars = [];
            let nextCarIdCounter = 1;

            // --- Utility Functions ---

            function showMessage(message, type = 'error') {
                messageBox.textContent = message;
                messageBox.className = `mt-6 p-4 text-sm rounded-lg ${type === 'error' ? 'text-red-700 bg-red-100' : 'text-green-700 bg-green-100'} visible`;
                messageBox.classList.remove('hidden');
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 5000);
            }

            function generateUniqueCarId() {
                let id;
                let counter = nextCarIdCounter;
                do {
                    id = `C${counter}`;
                    counter++;
                } while (cars.some(c => c.id === id));
                nextCarIdCounter = counter;
                return id;
            }

            // --- CRUD Operations for Cars ---

            function addCar() {
                const arrivalInput = document.getElementById('arrival');
                const serviceInput = document.getElementById('service');

                let id = idInput.value.trim();
                const arrival = parseInt(arrivalInput.value, 10);
                const service = parseInt(serviceInput.value, 10);

                if (isNaN(arrival) || isNaN(service) || service <= 0 || arrival < 0) {
                    showMessage("Please enter valid, non-negative arrival time and a positive service time.");
                    return;
                }
                
                let uniqueId = id;
                if (!id || cars.some(c => c.id === id)) {
                    // Generate new ID if input is empty or a duplicate
                    uniqueId = generateUniqueCarId();
                    if (id) {
                         showMessage(`Car ID "${id}" already exists. Assigned new ID: ${uniqueId}.`, 'error');
                    }
                }

                cars.push({ id: uniqueId, arrival, service });
                
                // Reset inputs for the next entry
                idInput.value = generateUniqueCarId(); 
                arrivalInput.value = '0';
                serviceInput.value = '5';
                
                renderCarList();
                resultsArea.classList.add('hidden'); // Hide results after adding new car
                showMessage(`Car ${uniqueId} added to the queue.`, 'success');
            }

            function deleteCar(id) {
                cars = cars.filter(c => c.id !== id);
                renderCarList();
                resultsArea.classList.add('hidden'); // Hide results after deletion
                showMessage(`Car ${id} removed from the queue.`, 'success');
            }

            function renderCarList() {
                carListBody.innerHTML = '';
                if (cars.length === 0) {
                    carListBody.innerHTML = '<tr><td colspan="4" class="py-4 text-center text-gray-500">The toll booth queue is empty.</td></tr>';
                    // Reset the next car ID counter if the list is empty
                    nextCarIdCounter = 1; 
                    idInput.value = generateUniqueCarId(); 
                    return;
                }

                // Display cars in the order they were added
                cars.forEach(c => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${c.id}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${c.arrival}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${c.service}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                            <!-- Using data attribute for event delegation instead of brittle inline onclick -->
                            <button data-action="delete" data-car-id="${c.id}" class="text-red-600 hover:text-red-900 font-semibold transition">Remove</button>
                        </td>
                    `;
                    carListBody.appendChild(row);
                });
            }
            
            // --- FCFS Calculation Logic (No changes needed here, it was correct) ---

            function runFCFSSimulation() {
                if (cars.length === 0) {
                    showMessage("Please add at least one car to run the simulation.");
                    return;
                }

                // 1. Create a deep copy and sort: FCFS is determined by Arrival Time (AT), then by ID (for tie-breaking/stability).
                let sortedCars = JSON.parse(JSON.stringify(cars)).sort((a, b) => {
                    if (a.arrival !== b.arrival) {
                        return a.arrival - b.arrival;
                    }
                    // Secondary sort key: Car ID for stable ordering
                    return a.id.localeCompare(b.id); 
                });

                let currentTime = 0;
                let totalTAT = 0;
                let totalWT = 0;

                let results = [];
                let ganttData = [];

                sortedCars.forEach(c => {
                    // Time the car starts its transaction (Start Time = max(Current CPU Time, Car Arrival Time))
                    const startTime = Math.max(currentTime, c.arrival);
                    
                    // Waiting Time (WT) = Start Time - Arrival Time
                    c.waitTime = startTime - c.arrival;
                    
                    // Finish Time (FT) = Start Time + Service Time
                    c.finishTime = startTime + c.service;
                    
                    // Turnaround Time (TAT) = Finish Time - Arrival Time
                    c.turnaroundTime = c.finishTime - c.arrival;

                    // Update total metrics
                    totalTAT += c.turnaroundTime;
                    totalWT += c.waitTime;
                    
                    // Add to results
                    results.push(c);

                    // Add to Gantt data (Idle time if current time is less than start time)
                    if (startTime > currentTime) {
                        ganttData.push({ 
                            id: 'Idle', 
                            start: currentTime, 
                            end: startTime, 
                            service: startTime - currentTime 
                        });
                    }
                    ganttData.push({ 
                        id: c.id, 
                        start: startTime, 
                        end: c.finishTime, 
                        service: c.service
                    });
                    
                    // Update current time for the next transaction
                    currentTime = c.finishTime;
                });

                // 3. Render Results
                renderGanttChart(ganttData);
                renderResultsTable(results, totalTAT, totalWT);
                resultsArea.classList.remove('hidden');
            }

            // --- Rendering Functions ---

            function renderGanttChart(ganttData) {
                ganttChart.innerHTML = '';
                ganttChart.style.minHeight = '100px'; 
                
                const totalTime = ganttData.length > 0 ? ganttData[ganttData.length - 1].end : 0;
                
                // Add the initial marker at 0
                const initialMarker = document.createElement('div');
                initialMarker.className = "gantt-time-marker absolute left-0 bottom-[-25px] right-auto";
                initialMarker.textContent = "0";
                ganttChart.appendChild(initialMarker);

                ganttData.forEach((item) => {
                    // Calculate width proportional to the total time. Ensure a minimum width for visibility.
                    // If totalTime is 0, default to 100% (shouldn't happen if cars exist)
                    const widthPercent = totalTime > 0 ? (item.service / totalTime) * 100 : 100;
                    const block = document.createElement('div');
                    
                    const isIdle = item.id === 'Idle';
                    const bgColorClass = isIdle ? 'gantt-block idle' : 'gantt-block';
                    const label = isIdle ? 'IDLE' : item.id;
                    
                    block.className = `${bgColorClass} relative flex-shrink-0`;
                    // Use a flex-basis calculation for better responsive layout, minimum width 30px
                    block.style.flexBasis = `${Math.max(widthPercent, 5)}%`; 
                    block.style.minWidth = '30px'; 

                    block.innerHTML = `
                        ${label}
                        <div class="gantt-time-marker">${item.end}</div>
                    `;
                    ganttChart.appendChild(block);
                });
            }

            function renderResultsTable(results, totalTAT, totalWT) {
                resultsBody.innerHTML = '';
                
                results.forEach(c => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-indigo-50/50';
                    row.innerHTML = `
                        <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${c.id}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700">${c.arrival}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700">${c.service}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm font-semibold text-emerald-600">${c.finishTime}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm font-semibold text-blue-600">${c.turnaroundTime}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm font-semibold text-orange-600">${c.waitTime}</td>
                    `;
                    resultsBody.appendChild(row);
                });

                const count = results.length;
                if (count > 0) {
                    avgTATElement.textContent = (totalTAT / count).toFixed(2);
                    avgWTElement.textContent = (totalWT / count).toFixed(2);
                } else {
                    avgTATElement.textContent = '0.00';
                    avgWTElement.textContent = '0.00';
                }
            }
            
            // --- Initialization and Event Listeners ---
            
            document.getElementById('addCarBtn').addEventListener('click', addCar);
            document.getElementById('runSimulationBtn').addEventListener('click', runFCFSSimulation);

            // FIX: Use Event Delegation for dynamically created "Remove" buttons
            carListBody.addEventListener('click', (event) => {
                const target = event.target;
                if (target.dataset.action === 'delete') {
                    const carId = target.dataset.carId;
                    if (carId) {
                        deleteCar(carId);
                    }
                }
            });

            // Add initial example cars demonstrating the Convoy Effect
            cars.push({ id: 'C1 (Truck)', arrival: 0, service: 10 }); // Long service time
            cars.push({ id: 'C2 (Car)', arrival: 1, service: 2 });
            cars.push({ id: 'C3 (Car)', arrival: 2, service: 3 });
            nextCarIdCounter = 4; // Start counter after C3
            
            // Initialize input field with the next predicted ID
            idInput.value = generateUniqueCarId(); 

            renderCarList();
        });
    </script>
</body>
</html>
